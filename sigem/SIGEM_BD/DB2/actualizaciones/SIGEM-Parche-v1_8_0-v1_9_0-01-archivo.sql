--/***************************/
--/* Versión 3.4             */
--/***************************/

--  Crear tablas para el conector de organización

CREATE TABLE AOESTRORG(
	ID               VARCHAR(32) NOT NULL,
	CODIGO           VARCHAR(64) NOT NULL,
	NOMBRE           VARCHAR(254) NOT NULL,
	TIPO             INTEGER NOT NULL,
	NIVEL            INTEGER NOT NULL,
	IDORGPADRE       VARCHAR(32),
	ESTADO           INTEGER NOT NULL,
	FINICIOVIGENCIA  TIMESTAMP,
	FFINVIGENCIA     TIMESTAMP,
	DESCRIPCION      VARCHAR(254)
);

CREATE TABLE AOUSR(
	ID             VARCHAR(64) NOT NULL,
	DIRECCION      VARCHAR(254),
	EMAIL          VARCHAR(254),
	NOMBRE         VARCHAR(64),
	APELLIDOS      VARCHAR(128),
	NOMBREUSUARIO  VARCHAR(64) NOT NULL,
	PASSWORD       VARCHAR(64) NOT NULL
);

CREATE TABLE AOUSRORGV(
	IDUSUARIO      VARCHAR(64) NOT NULL,
	NOMBREUSUARIO  VARCHAR(254) NOT NULL,
	IDORGANO       VARCHAR(32) NOT NULL
);

CREATE UNIQUE INDEX ORGANIZACION1 ON AOESTRORG (ID);
CREATE UNIQUE INDEX ORGANIZACION2 ON AOESTRORG (CODIGO);

CREATE INDEX USUARIO1 ON AOUSR (NOMBRE);
CREATE UNIQUE INDEX USUARIO2 ON AOUSR (NOMBREUSUARIO);

CREATE UNIQUE INDEX USRORGANO1 ON AOUSRORGV (IDUSUARIO);

DROP INDEX ASGTUDOCSDF2;
CREATE UNIQUE INDEX ASGTUDOCSDF2 ON ASGTUDOCSDF (ID ASC, IDRELENTREGA ASC) ;

-- Actualizar el nombre de clasificador de serie de una ficha
UPDATE ADFICHA SET NOMBRE='ISAD(G) Nivel de Descripción Clasificador Serie' WHERE ID='3';

INSERT INTO AGINFOSISTEMA (NOMBRE,VALOR,FECHAACTUALIZACION) VALUES ('VERSIONBD','3.4',CURRENT TIMESTAMP);